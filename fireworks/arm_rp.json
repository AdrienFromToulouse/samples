{
  "$schema": "http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "location": {
      "defaultValue": "SouthCentralUS",
      "type": "String",
      "metadata": {
        "description": "Location of the resources."
      }
    }
  },
  "resources": [
    {
      "apiVersion": "2019-08-01-privatepreview",
      "name": "fireworks-frontend",
      "type": "Microsoft.Hydra/components",
      "location": "[parameters('location')]",
      "dependsOn": [
        "Microsoft.Hydra/networkScopes/testNetworkScope2"
      ],
      "properties": {
        "parameterValues": [
          {
            "name": "objectcounter",
            "value": "500"
          }
        ],
        "schematic": {
          "apiVersion": "core.hydra.io/v1alpha1",
          "kind": "ComponentSchematic",
          "metadata": {
            "name": "fireworks-frontend",
            "version": "1.0.0",
            "description": "Fireworks Web Container"
          },
          "spec": {
            "workloadType": "core.hydra.io/v1.Replicated",
            "parameters": [
              {
                "name": "objectcounter",
                "description": "Maximum number of objects",
                "type": "string"
              }
            ],
            "ostype": "linux",
            "containers": [
              {
                "name": "web",
                "resources": {
                  "cpu": {
                    "required": 2.0
                  },
                  "memory": {
                    "required": "4G"
                  }
                },
                "ports": [
                  {
                    "name": "http",
                    "containerPort": 80
                  }
                ],
                "env": [
                  {
                    "name": "ASPNETCORE_URLS",
                    "value": "http://+:80"
                  },
                  {
                    "name": "OBJECTCOUNTER_MAX_COUNT_OUTPUT_LIMIT",
                    "fromParam": "objectcounter"
                  }
                ],
                "image": {
                  "name": "seabreeze/azure-mesh-fireworks-web:1.1-alpine",
                  "digest": "sha256:6c3c624b58dbbcd3c0dd82b4c53f04194d1247c6eebdaab7c610cf7d66709b3b"
                }
              }
            ]
          }
        },
        "traits": [
          {
            "name": "web-scaler",
            "type": "core.hydra.io/v1alpha1.ManualScaler",
            "properties": {
              "replicaCount": 1
            }
          }
        ],
        "applicationScopes": [
          {
            "name": "[resourceId('Microsoft.Hydra/networkScopes', 'testNetworkScope2')]",
            "type": "core.hydra.io/v1alpha1.Network"
          }
        ]
      }
    },
    {
      "apiVersion": "2019-08-01-privatepreview",
      "name": "fireworks-worker1",
      "type": "Microsoft.Hydra/components",
      "location": "[parameters('location')]",
      "dependsOn": [
        "Microsoft.Hydra/networkScopes/testNetworkScope2"
      ],
      "properties": {
        "parameterValues": [
          {
            "name": "firework_color",
            "value": "red"
          },
          {
            "name": "object_counter_address",
            "value": "fireworks-frontend.testNetworkScope2"
          }
        ],
        "schematic": {
          "apiVersion": "core.hydra.io/v1alpha1",
          "kind": "ComponentSchematic",
          "metadata": {
            "name": "fireworks-worker",
            "version": "1.0.0",
            "description": "Fireworks Worker Container"
          },
          "spec": {
            "workloadType": "core.hydra.io/v1.Replicated",
            "parameters": [
              {
                "name": "firework_color",
                "description": "The color of the firework",
                "type": "string"
              },
              {
                "name": "object_counter_address",
                "description": "The address of the web frontend",
                "type": "string"
              }
            ],
            "ostype": "linux",
            "containers": [
              {
                "name": "worker",
                "ports": [
                  {
                    "name": "http",
                    "containerPort": 80
                  }
                ],
                "resources": {
                  "cpu": {
                    "required": 2.0
                  },
                  "memory": {
                    "required": "4G"
                  }
                },
                "env": [
                  {
                    "name": "OBJECT_TYPE",
                    "fromParam": "firework_color"
                  },
                  {
                    "name": "OBJECTCOUNTER_ADDRESS",
                    "fromParam": "object_counter_address"
                  }
                ],
                "image": {
                  "name": "vipulmmsft/azure-mesh-fireworks-worker-v1:0.4-strech",
                  "digest": "sha256:6c3c624b58dbbcd3c0dd82b4c53f04194d1247c6eebdaab7c610cf7d66709b3b"
                }
              }
            ]
          }
        },
        "traits": [
          {
            "name": "worker-scaler",
            "type": "core.hydra.io/v1alpha1.ManualScaler",
            "properties": {
              "replicaCount": 3
            }
          }
        ],
        "applicationScopes": [
          {
            "name": "[resourceId('Microsoft.Hydra/networkScopes', 'testNetworkScope2')]",
            "type": "core.hydra.io/v1alpha1.Network"
          }
        ]
      }
    },
    {
      "apiVersion": "2019-08-01-privatepreview",
      "name": "fireworks-worker2",
      "type": "Microsoft.Hydra/components",
      "location": "[parameters('location')]",
      "dependsOn": [
        "Microsoft.Hydra/networkScopes/testNetworkScope2"
      ],
      "properties": {
        "parameterValues": [
          {
            "name": "firework_color",
            "value": "green"
          },
          {
            "name": "object_counter_address",
            "value": "fireworks-frontend.testNetworkScope2"
          }
        ],
        "schematic": {
          "apiVersion": "core.hydra.io/v1alpha1",
          "kind": "ComponentSchematic",
          "metadata": {
            "name": "fireworks-worker",
            "version": "1.0.0",
            "description": "Fireworks Worker Container"
          },
          "spec": {
            "workloadType": "core.hydra.io/v1.Replicated",
            "parameters": [
              {
                "name": "firework_color",
                "description": "The color of the firework",
                "type": "string"
              },
              {
                "name": "object_counter_address",
                "description": "The address of the web frontend",
                "type": "string"
              }
            ],
            "ostype": "linux",
            "containers": [
              {
                "name": "worker",
                "ports": [
                  {
                    "name": "http",
                    "containerPort": 80
                  }
                ],
                "resources": {
                  "cpu": {
                    "required": 2.0
                  },
                  "memory": {
                    "required": "4G"
                  }
                },
                "env": [
                  {
                    "name": "OBJECT_TYPE",
                    "fromParam": "firework_color"
                  },
                  {
                    "name": "OBJECTCOUNTER_ADDRESS",
                    "fromParam": "object_counter_address"
                  }
                ],
                "image": {
                  "name": "vipulmmsft/azure-mesh-fireworks-worker-v1:0.4-strech",
                  "digest": "sha256:6c3c624b58dbbcd3c0dd82b4c53f04194d1247c6eebdaab7c610cf7d66709b3b"
                }
              }
            ]
          }
        },
        "traits": [
          {
            "name": "worker-scaler",
            "type": "core.hydra.io/v1alpha1.ManualScaler",
            "properties": {
              "replicaCount": 3
            }
          }
        ],
        "applicationScopes": [
          {
            "name": "[resourceId('Microsoft.Hydra/networkScopes', 'testNetworkScope2')]",
            "type": "core.hydra.io/v1alpha1.Network"
          }
        ]
      }
    },
    {
      "apiVersion": "2019-08-01-privatepreview",
      "name": "fireworks-worker3",
      "type": "Microsoft.Hydra/components",
      "location": "[parameters('location')]",
      "dependsOn": [
        "Microsoft.Hydra/networkScopes/testNetworkScope2"
      ],
      "properties": {
        "parameterValues": [
          {
            "name": "firework_color",
            "value": "blue"
          },
          {
            "name": "object_counter_address",
            "value": "fireworks-frontend.testNetworkScope2"
          }
        ],
        "schematic": {
          "apiVersion": "core.hydra.io/v1alpha1",
          "kind": "ComponentSchematic",
          "metadata": {
            "name": "fireworks-worker",
            "version": "1.0.0",
            "description": "Fireworks Worker Container"
          },
          "spec": {
            "workloadType": "core.hydra.io/v1.Replicated",
            "parameters": [
              {
                "name": "firework_color",
                "description": "The color of the firework",
                "type": "string"
              },
              {
                "name": "object_counter_address",
                "description": "The address of the web frontend",
                "type": "string"
              }
            ],
            "ostype": "linux",
            "containers": [
              {
                "name": "worker",
                "ports": [
                  {
                    "name": "http",
                    "containerPort": 80
                  }
                ],
                "resources": {
                  "cpu": {
                    "required": 2.0
                  },
                  "memory": {
                    "required": "4G"
                  }
                },
                "env": [
                  {
                    "name": "OBJECT_TYPE",
                    "fromParam": "firework_color"
                  },
                  {
                    "name": "OBJECTCOUNTER_ADDRESS",
                    "fromParam": "object_counter_address"
                  }
                ],
                "image": {
                  "name": "vipulmmsft/azure-mesh-fireworks-worker-v1:0.4-strech",
                  "digest": "sha256:6c3c624b58dbbcd3c0dd82b4c53f04194d1247c6eebdaab7c610cf7d66709b3b"
                }
              }
            ]
          }
        },
        "traits": [
          {
            "name": "worker-scaler",
            "type": "core.hydra.io/v1alpha1.ManualScaler",
            "properties": {
              "replicaCount": 3
            }
          }
        ],
        "applicationScopes": [
          {
            "name": "[resourceId('Microsoft.Hydra/networkScopes', 'testNetworkScope2')]",
            "type": "core.hydra.io/v1alpha1.Network"
          }
        ]
      }
    },
    {
      "apiVersion": "2019-08-01-privatepreview",
      "name": "testNetworkScope2",
      "type": "Microsoft.Hydra/networkScopes",
      "location": "[parameters('location')]",
      "dependsOn": [],
      "properties": {
        "type": "core.hydra.io/v1alpha1.Network",
        "networkName": "/subscriptions/1520019f-4b18-4cd4-a84d-b931699b2e8e/resourceGroups/suhuruli-fireworks/providers/Microsoft.Network/virtualNetworks/suhuruli-vnet/subnets/hydra"
      }
    }
  ],
  "outputs": {}
}